# Database security patterns (Redis, MongoDB, PostgreSQL, MySQL, SQL, message queues, Prisma, Flyway, Liquibase)
bashToolPatterns:
  # ---------------------------------------------------------------------------
  # REDIS DESTRUCTIVE OPERATIONS
  # ---------------------------------------------------------------------------
  - pattern: '\bredis-cli\b.*\bFLUSH(ALL|DB)\b'
    reason: redis-cli FLUSH (wipes data from current DB or all DBs)

  - pattern: '\bredis-cli\b.*\bCONFIG\s+(SET|REWRITE)\b'
    reason: redis-cli CONFIG SET/REWRITE (modifies runtime config or overwrites redis.conf)

  - pattern: '\bredis-cli\b.*\bDEBUG\b'
    reason: redis-cli DEBUG (dangerous debug operations)

  - pattern: '\bredis-cli\b.*\b(SLAVEOF|REPLICAOF)\b'
    reason: redis-cli SLAVEOF/REPLICAOF (modifies replication configuration)

  - pattern: '\bredis-cli\b.*\bSHUTDOWN\b'
    reason: redis-cli SHUTDOWN (stops the Redis server)

  # ---------------------------------------------------------------------------
  # MONGODB DESTRUCTIVE OPERATIONS
  # ---------------------------------------------------------------------------
  - pattern: '\bmongosh?\b.*\bdropDatabase\b'
    reason: MongoDB dropDatabase (destroys entire database)

  - pattern: '\bmongosh?\b.*\.(drop|dropCollection)\s*\('
    reason: MongoDB drop/dropCollection (destroys collection)

  - pattern: '\bmongosh?\b.*\.deleteMany\s*\(\s*\{\s*\}'
    reason: MongoDB deleteMany({}) (deletes all documents)

  # ---------------------------------------------------------------------------
  # POSTGRESQL DESTRUCTIVE OPERATIONS
  # ---------------------------------------------------------------------------
  - pattern: '\bdropdb\b'
    reason: PostgreSQL dropdb (drops entire database)

  - pattern: '\bdropuser\b'
    reason: PostgreSQL dropuser (drops database user/role)

  - pattern: '\bpsql\b.*(-c|--command)\s+.*(DROP|TRUNCATE|DELETE\s+FROM)'
    reason: psql with destructive SQL

  # ---------------------------------------------------------------------------
  # MYSQL / MARIADB DESTRUCTIVE OPERATIONS
  # ---------------------------------------------------------------------------
  - pattern: '\bmysqladmin\s+drop\b'
    reason: MySQL drop database via mysqladmin

  - pattern: '\b(mysql|mariadb)\b.*(-e|--execute)\s+.*(DROP|TRUNCATE|DELETE\s+FROM)'
    reason: mysql/mariadb with destructive SQL

  # ---------------------------------------------------------------------------
  # SQL DESTRUCTIVE OPERATIONS (catastrophic - no WHERE clause)
  # ---------------------------------------------------------------------------
  - pattern: 'DELETE\s+FROM\s+[\w.`"]+\s*(;|$)'
    reason: DELETE without WHERE clause (will delete ALL rows)

  - pattern: 'DELETE\s+\*\s+FROM'
    reason: DELETE * (will delete ALL rows)

  - pattern: '\bTRUNCATE\s+TABLE\b'
    reason: TRUNCATE TABLE (will delete ALL rows irrecoverably)

  - pattern: '\bDROP\s+TABLE\b'
    reason: DROP TABLE (destroys table and all its data)

  - pattern: '\bDROP\s+DATABASE\b'
    reason: DROP DATABASE (destroys entire database)

  - pattern: '\bDROP\s+SCHEMA\b'
    reason: DROP SCHEMA (destroys entire schema and all objects within it)

  # ---------------------------------------------------------------------------
  # MESSAGE QUEUE DESTRUCTIVE OPERATIONS
  # ---------------------------------------------------------------------------
  - pattern: '\brabbitmqctl\s+(delete_queue|delete_vhost|delete_exchange|delete_user|purge_queue|reset)\b'
    reason: rabbitmqctl destructive operation (deletes or resets RabbitMQ resources)

  - pattern: '\brabbitmqctl\s+(stop|shutdown)\b'
    reason: rabbitmqctl stop/shutdown (stops RabbitMQ server)

  - pattern: '\bkafka-(topics|consumer-groups|configs)\b.*--delete\b'
    reason: kafka --delete (destroys Kafka resource)

  # ---------------------------------------------------------------------------
  # SQL OPERATIONS REQUIRING CONFIRMATION (ask: true)
  # ---------------------------------------------------------------------------
  - pattern: '\bDELETE\s+FROM\s+\w+\s+WHERE\b.*\bid\s*='
    reason: SQL DELETE with specific ID
    ask: true

  # ---------------------------------------------------------------------------
  # PRISMA DATABASE MIGRATIONS
  # ---------------------------------------------------------------------------
  - pattern: '\b(npx\s+)?prisma\s+migrate\s+reset\b'
    reason: prisma migrate reset (drops and recreates database)

  - pattern: '\b(npx\s+)?prisma\s+db\s+push\s+.*--force-reset\b'
    reason: prisma db push --force-reset (resets database before pushing schema)

  - pattern: '\b(npx\s+)?prisma\s+db\s+execute\b'
    reason: prisma db execute (runs raw SQL against database)
    ask: true

  - pattern: '\b(npx\s+)?prisma\s+migrate\s+deploy\b'
    reason: prisma migrate deploy (applies pending migrations to production)
    ask: true

  # ---------------------------------------------------------------------------
  # FLYWAY / LIQUIBASE DATABASE MIGRATIONS
  # ---------------------------------------------------------------------------
  - pattern: '\bflyway\s+clean\b'
    reason: flyway clean (drops ALL objects in schema)

  - pattern: '\bliquibase\s+drop-all\b'
    reason: liquibase drop-all (drops all database objects)

  - pattern: '\bflyway\s+undo\b'
    reason: flyway undo (undoes most recent migration)
    ask: true

  - pattern: '\bliquibase\s+rollback\b'
    reason: liquibase rollback (rolls back database changes)
    ask: true
