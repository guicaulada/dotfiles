# vim:fileencoding=utf-8:foldmethod=marker

# Fonts {{{

font_family      MesloLGS NF
bold_font        auto
italic_font      auto
bold_italic_font auto
font_size        14.0
disable_ligatures never

# }}}

# Cursor {{{

cursor_shape block
cursor_shape_unfocused hollow
cursor_blink_interval 0
cursor_trail 0

# }}}

# Scrollback {{{

scrollback_lines 10000
scrollback_pager_history_size 4
scrollback_pager nvim --cmd 'set eventignore=FileType' +'nnoremap q ZQ' +'call nvim_open_term(0, {})' +'set nomodified nolist' +'$' -

# }}}

# Mouse {{{

mouse_hide_wait -1
copy_on_select clipboard
strip_trailing_spaces smart
show_hyperlink_targets yes
paste_actions quote-urls-at-prompt,confirm,confirm-if-large

# }}}

# Performance {{{

repaint_delay 10
input_delay 3
sync_to_monitor yes

# }}}

# Bell {{{

enable_audio_bell no
visual_bell_duration 0.0
window_alert_on_bell yes
bell_on_tab " "

# }}}

# Window layout {{{

remember_window_size yes
enabled_layouts splits,stack
window_padding_width 8
hide_window_decorations no
confirm_os_window_close -1
placement_strategy center
draw_minimal_borders yes

inactive_text_alpha 0.8

# }}}

# Tab bar {{{

tab_bar_edge top
tab_bar_style powerline
tab_powerline_style angled
tab_bar_min_tabs 1
tab_title_template " {index}: {tab.active_wd.rsplit('/', 1)[-1]} "
tab_switch_strategy previous
tab_activity_symbol " "

active_tab_font_style   bold
inactive_tab_font_style normal

# }}}

# Colors: using kitty defaults
# Run `kitten themes` to browse and apply a theme

# Advanced {{{

shell_integration enabled
allow_remote_control yes
listen_on unix:/tmp/kitty-{kitty_pid}
notify_on_cmd_finish unfocused 5.0
update_check_interval 0
macos_option_as_alt both
macos_quit_when_last_window_closed yes
macos_titlebar_color system
startup_session ~/.config/kitty/last-session.kitty

# }}}

# Keyboard shortcuts {{{

# Reload config
map kitty_mod+f5 load_config_file

# Session persistence (saves on quit, tab close, and manual trigger)
map kitty_mod+f6 launch --type=background python3 ~/.config/kitty/save-session.py
map cmd+q launch --type=background sh -c 'python3 ~/.config/kitty/save-session.py && kitten @ quit'
map cmd+w launch --type=background sh -c 'python3 ~/.config/kitty/save-session.py && kitten @ close-tab'
map shift+cmd+w launch --type=background sh -c 'python3 ~/.config/kitty/save-session.py && kitten @ close-window'

# Splits
map kitty_mod+minus launch --location=hsplit --cwd=current
map kitty_mod+backslash launch --location=vsplit --cwd=current

# Navigate splits
map kitty_mod+h neighboring_window left
map kitty_mod+l neighboring_window right
map kitty_mod+k neighboring_window up
map kitty_mod+j neighboring_window down

# Move splits
map kitty_mod+shift+h move_window left
map kitty_mod+shift+l move_window right
map kitty_mod+shift+k move_window up
map kitty_mod+shift+j move_window down

# Resize splits
map kitty_mod+r start_resizing_window
map kitty_mod+left  resize_window wider 2
map kitty_mod+right resize_window narrower 2
map kitty_mod+up    resize_window taller 2
map kitty_mod+down  resize_window shorter 2

# Detach pane to new tab
map kitty_mod+d detach_window new-tab

# Zoom toggle (stack layout)
map kitty_mod+z toggle_layout stack

# Tab jumping
map alt+1 goto_tab 1
map alt+2 goto_tab 2
map alt+3 goto_tab 3
map alt+4 goto_tab 4
map alt+5 goto_tab 5
map alt+6 goto_tab 6
map alt+7 goto_tab 7
map alt+8 goto_tab 8
map alt+9 goto_tab 9

# Hints kitten
map kitty_mod+p>f kitten hints --type path --program -
map kitty_mod+p>l kitten hints --type line --program -
map kitty_mod+p>w kitten hints --type word --program -
map kitty_mod+p>h kitten hints --type hash --program -
map kitty_mod+p>n kitten hints --type linenum

# Pipe output to pager
map kitty_mod+g show_last_command_output
map f1 launch --stdin-source=@screen_scrollback --stdin-add-formatting --type=overlay less +G -R
map f2 launch --stdin-source=@last_cmd_output --stdin-add-formatting --type=overlay less +G -R

# Load saved layout in new tab
map kitty_mod+alt+l launch --type=overlay --cwd=current sh -c 'ls ~/.config/kitty/layouts/*.session 2>/dev/null | sed "s|.*/||;s|\.session||" | fzf --prompt="Load layout: " | xargs -I{} kitten @ launch --type=tab --cwd=current --session ~/.config/kitty/layouts/{}.session'

# }}}
