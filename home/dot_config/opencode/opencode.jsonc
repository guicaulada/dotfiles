{
  "$schema": "https://opencode.ai/config.json",

  // General
  "autoupdate": true,
  "share": "manual",

  // Permissions
  // Last matching rule wins. Use "*" as catch-all first, specific rules after.
  "permission": {
    "*": "allow",

    // Keep path-scope and loop-protection interactive.
    "external_directory": "ask",
    "doom_loop": "ask",

    // Deny reading and searching sensitive files (secrets, keys, credentials)
    "read": {
      "*": "allow",
      "*.env": "deny",
      "*.env.*": "deny",
      "*.env.example": "allow",
      "**/.env": "deny",
      "**/.env.*": "deny",
      "**/.env.example": "allow",
      "**/secrets/**": "deny",
      "**/credentials.json": "deny",
      "**/.npmrc": "deny",
      "**/.pypirc": "deny",
      "**/*.pem": "deny",
      "**/*.key": "deny",
      "**/*.p12": "deny",
      "**/*.pfx": "deny",
      "**/*.tfstate": "deny",
      "**/*.tfvars": "deny",
      "**/.git-credentials": "deny",
      "~/.ssh/**": "deny",
      "~/.aws/**": "deny",
      "~/.config/gcloud/**": "deny",
      "~/.netrc": "deny",
      "~/.npmrc": "deny",
      "~/.docker/config.json": "deny",
      "~/.kube/config": "deny",
      "~/.config/gh/hosts.yml": "deny",
      "~/.gnupg/**": "deny"
    },
    "grep": {
      "*": "allow",
      "*.env": "deny",
      "*.env.*": "deny",
      "*.env.example": "allow",
      "**/.env": "deny",
      "**/.env.*": "deny",
      "**/.env.example": "allow",
      "**/secrets/**": "deny",
      "**/credentials.json": "deny",
      "**/.npmrc": "deny",
      "**/.pypirc": "deny",
      "**/*.pem": "deny",
      "**/*.key": "deny",
      "**/*.p12": "deny",
      "**/*.pfx": "deny",
      "**/*.tfstate": "deny",
      "**/*.tfvars": "deny",
      "**/.git-credentials": "deny",
      "~/.ssh/**": "deny",
      "~/.aws/**": "deny",
      "~/.config/gcloud/**": "deny",
      "~/.netrc": "deny",
      "~/.npmrc": "deny",
      "~/.docker/config.json": "deny",
      "~/.kube/config": "deny",
      "~/.config/gh/hosts.yml": "deny",
      "~/.gnupg/**": "deny"
    },

    // Destructive file changes require approval.
    "edit": "ask",

    // Other tools — allow without prompting
    "glob": "allow",
    "list": "allow",
    "webfetch": "allow",
    "websearch": "allow",
    "skill": "allow",
    "todowrite": "allow",
    "todoread": "allow",
    "question": "allow",
    "task": "ask",

    // Bash — allow by default, ask for risky or destructive operations.
    "bash": {
      "*": "allow",

      // Privilege escalation and remote script execution.
      "sudo *": "ask",
      "su *": "ask",
      "doas *": "ask",
      "bash -c *": "ask",
      "sh -c *": "ask",
      "zsh -c *": "ask",
      "curl *|*": "ask",
      "curl * | *": "ask",
      "wget *|*": "ask",
      "wget * | *": "ask",

      // Shell redirections and file-writing operators.
      "*>*": "ask",
      "*>>*": "ask",
      "*1>*": "ask",
      "*1>>*": "ask",
      "*2>*": "ask",
      "*2>>*": "ask",
      "*&>*": "ask",
      "*| tee *": "ask",

      // Writing to device files should be explicit.
      "*>/dev/*": "ask",
      "*> /dev/*": "ask",
      "*>>/dev/*": "ask",
      "*>> /dev/*": "ask",
      "*2>/dev/*": "ask",
      "*2> /dev/*": "ask",
      "*2>>/dev/*": "ask",
      "*2>> /dev/*": "ask",
      "*&>/dev/*": "ask",
      "*&> /dev/*": "ask",

      // Allow discarding output safely.
      "*>/dev/null*": "allow",
      "*> /dev/null*": "allow",
      "*>>/dev/null*": "allow",
      "*>> /dev/null*": "allow",
      "*2>/dev/null*": "allow",
      "*2> /dev/null*": "allow",
      "*2>>/dev/null*": "allow",
      "*2>> /dev/null*": "allow",
      "*&>/dev/null*": "allow",
      "*&> /dev/null*": "allow",

      // Local filesystem and permissions mutations.
      "rm *": "ask",
      "rmdir *": "ask",
      "unlink *": "ask",
      "mv *": "ask",
      "cp -f *": "ask",
      "cp --force *": "ask",
      "install *": "ask",
      "truncate *": "ask",
      "chmod *": "ask",
      "chown *": "ask",
      "chgrp *": "ask",
      "dd *": "ask",
      "mkfs*": "ask",
      "newfs *": "ask",
      "diskutil erase*": "ask",

      // Process and host lifecycle operations.
      "kill *": "ask",
      "pkill *": "ask",
      "killall *": "ask",
      "shutdown *": "ask",
      "reboot *": "ask",
      "halt *": "ask",
      "poweroff *": "ask",

      // History-rewriting or otherwise destructive git operations.
      "git reset *": "ask",
      "git clean *": "ask",
      "git restore *": "ask",
      "git checkout --*": "ask",
      "git rebase *": "ask",
      "git commit --amend*": "ask",
      "git branch -D *": "ask",
      "git tag -d *": "ask",
      "git push --force*": "ask",
      "git push * --force*": "ask",
      "git push * --delete *": "ask",

      // GitHub remote mutations.
      "gh * delete *": "ask",
      "gh * edit *": "ask",
      "gh pr merge *": "ask",
      "gh pr close *": "ask",
      "gh issue close *": "ask",
      "gh api * -X *": "ask",
      "gh api * --method *": "ask",

      // Cloud and infrastructure mutation verbs.
      "aws * create-* *": "ask",
      "aws * put-* *": "ask",
      "aws * update-* *": "ask",
      "aws * delete-* *": "ask",
      "aws * remove-* *": "ask",
      "aws * attach-* *": "ask",
      "aws * detach-* *": "ask",
      "aws * start-* *": "ask",
      "aws * stop-* *": "ask",
      "aws * terminate-* *": "ask",
      "aws * reboot-* *": "ask",
      "aws * modify-* *": "ask",
      "aws * set-* *": "ask",
      "gcloud * create *": "ask",
      "gcloud * update *": "ask",
      "gcloud * delete *": "ask",
      "gcloud * deploy *": "ask",
      "gcloud * set *": "ask",
      "gcloud * unset *": "ask",
      "az * create *": "ask",
      "az * update *": "ask",
      "az * delete *": "ask",
      "az * start *": "ask",
      "az * stop *": "ask",
      "az * restart *": "ask",
      "az * set *": "ask",

      // Containers, cluster changes, and IaC apply/destroy.
      "docker rm *": "ask",
      "docker rmi *": "ask",
      "docker stop *": "ask",
      "docker kill *": "ask",
      "docker restart *": "ask",
      "docker compose up *": "ask",
      "docker compose down *": "ask",
      "docker container prune *": "ask",
      "docker image prune *": "ask",
      "docker volume prune *": "ask",
      "docker network prune *": "ask",
      "docker system prune *": "ask",
      "kubectl apply *": "ask",
      "kubectl create *": "ask",
      "kubectl replace *": "ask",
      "kubectl patch *": "ask",
      "kubectl edit *": "ask",
      "kubectl delete *": "ask",
      "kubectl scale *": "ask",
      "kubectl rollout restart *": "ask",
      "terraform apply *": "ask",
      "terraform destroy *": "ask",
      "terraform state rm *": "ask",
      "terraform import *": "ask",

      // Package publishing and host-level package changes.
      "npm publish *": "ask",
      "npm unpublish *": "ask",
      "pnpm publish *": "ask",
      "yarn npm publish *": "ask",
      "brew install *": "ask",
      "brew uninstall *": "ask",
      "brew upgrade *": "ask",

      // Keep direct text/file dumping via bash interactive so read/grep
      // sensitive-file rules stay meaningful.
      "grep *": "ask",
      "rg *": "ask",
      "find *": "ask",
      "cat *": "ask",
      "head *": "ask",
      "tail *": "ask",
      "less *": "ask",
      "more *": "ask",

      // Dangerous find execution forms still require explicit approval.
      "find * -delete*": "ask",
      "find * -exec*": "ask",
      "find * -ok*": "ask"
    }
  },

  // Include rule files as additional instructions
  "instructions": [
    "~/.config/opencode/rules/*.md"
  ]
}
